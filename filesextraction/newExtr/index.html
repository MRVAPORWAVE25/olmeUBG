<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Search — Minimal</title>
<link rel="stylesheet" href="../styles.css">
<style>
  /* keep the local search chrome compact while using the shared site background */
  :root{ --accent:#9feee0; color:var(--accent); font-family:system-ui,-apple-system,Segoe UI,Roboto,'Helvetica Neue',Arial; }
  html,body{height:100%;margin:0;background:transparent;color:var(--accent);-webkit-font-smoothing:antialiased;display:flex;align-items:center;justify-content:center}
  .wrap{width:min(92vw,720px);padding:12px; z-index:2; position:relative}
  .bar{display:flex;gap:8px;align-items:center;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04)}
  input[type="search"]{flex:1;padding:12px 14px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--accent);outline:none;font-size:16px}
  button{background:linear-gradient(180deg,rgba(159,238,224,0.12),rgba(0,0,0,0.06));border:1px solid rgba(255,255,255,0.04);color:var(--accent);padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .muted{font-size:13px;color:rgba(223,246,239,0.6);margin-top:8px;text-align:center;position:relative;z-index:2}
  /* ensure the site's animated canvas sits behind content */
  #bg{ position:fixed; inset:0; z-index:0; }
</style>
  <style>
    /* small back button style to match site chrome */
    .back-btn{
      position:absolute;
      left:12px;
      top:12px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      height:40px;
      min-width:40px;
      padding:8px 10px;
      gap:8px;
      border-radius:10px;
      border:none;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));
      color: #cfeee9;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      z-index:3;
    }
    .back-btn:active{ transform: translateY(1px); }
  </style>
</head>
<body>
  <!-- use the site's shared animated background so preview matches homepage -->
  <canvas id="bg"></canvas>

  <!-- Back button to return to main page -->
  <button id="back-to-main" class="back-btn" aria-label="Back to main" title="Back to main">&larr; Back</button>

  <div class="wrap" role="main" aria-label="Minimal search">
    <div class="bar" role="search" aria-label="Search input">
      <input id="q" type="search" placeholder="Search — press Enter or click Search" aria-label="Search query" />
      <button id="go">Search</button>
    </div>
    <div class="muted">Search will send the query to the parent/host for handling.</div>
  </div>

<script>
(function(){
  const input = document.getElementById('q');
  const go = document.getElementById('go');

  function buildProviders(query){
    const q = encodeURIComponent(query || '');
    return {
      bing: 'https://www.bing.com/search?q=' + q,
      ddg:  'https://duckduckgo.com/?q=' + q,
      google: 'https://www.google.com/search?q=' + q
    };
  }

  function createFullscreenIframe(url){
    // create a full-page iframe that leaves the back button on top
    // ensure only one iframe exists
    let existing = document.getElementById('__search_full_iframe');
    if(existing){
      try { existing.src = url; } catch(e){}
      return existing;
    }
    const iframe = document.createElement('iframe');
    iframe.id = '__search_full_iframe';
    iframe.className = 'full-search-iframe';
    iframe.src = url;
    iframe.title = 'Search results';
    iframe.setAttribute('sandbox','allow-scripts allow-forms allow-same-origin');
    iframe.style.position = 'fixed';
    iframe.style.inset = '0';
    iframe.style.width = '100%';
    iframe.style.height = '100%';
    iframe.style.border = '0';
    iframe.style.zIndex = '2'; // keep below the back button (back button z-index:3)
    iframe.style.background = 'transparent';
    document.body.appendChild(iframe);

    // trap pointer events to allow the iframe to be interactive
    return iframe;
  }

  function sendQueryToParent(query){
    const providers = buildProviders(query);
    // post a structured message to parent; parent can pick provider and act
    const msg = { type: 'search', query: query, providers: providers, source: 'minimal-search', forceBing: true };
    try {
      if (window.parent && window.parent !== window) {
        // send to parent frame (preferred when embedded)
        window.parent.postMessage(msg, '*');
        return;
      } else if (window.opener) {
        // if opened as a popup, send to opener
        window.opener.postMessage(msg, '*');
        return;
      } else {
        // standalone: "beam" to Bing and show inside a fullscreen iframe that doesn't cover the back button
        createFullscreenIframe(providers.bing);
        return;
      }
    } catch (e) {
      // on error, fall back to creating the fullscreen iframe (avoid new tabs)
      try {
        createFullscreenIframe(providers.bing);
      } catch (err) {
        try { createFullscreenIframe(providers.bing); } catch (e2) {}
      }
    }
  }

  go.addEventListener('click', ()=>{
    const q = input.value.trim();
    if(!q) return;
    sendQueryToParent(q);
  });

  input.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      e.preventDefault();
      go.click();
    }
  });

  // prefill a sample term for convenience
  input.value = '';
})();
</script>

<!-- include site background script so the shared animated canvas runs -->
<script type="module" src="../main.js"></script>

<script>
  // Back button behavior: request the parent to remove any fullscreen iframe when embedded,
  // then navigate this window to the homepage (/index.html) in the same tab.
  (function(){
    const btn = document.getElementById('back-to-main');
    if(!btn) return;
    btn.addEventListener('click', () => {
      try {
        // If embedded, tell parent to remove the iframe (parent will reveal the main page)
        if (window.parent && window.parent !== window) {
          try {
            window.parent.postMessage({ type: 'close-preview', source: 'minimal-search' }, '*');
          } catch (e) {
            // ignore postMessage errors
          }
        }

        // If this document created a fullscreen iframe for search locally, remove it
        const iframe = document.getElementById('__search_full_iframe');
        if (iframe && iframe.parentNode) {
          try { iframe.parentNode.removeChild(iframe); } catch (e) {}
        }

        // Navigate this window to the site's homepage (explicit same-tab /index.html)
        try { window.location.href = '/index.html'; } catch (e) {
          // best-effort fallback: attempt history.back()
          try {
            if (window.history && window.history.length > 1) window.history.back();
          } catch (err){}
        }
      } catch (e) {
        try {
          if (window.history && window.history.length > 1) window.history.back();
          else window.location.href = '/index.html';
        } catch (err) {}
      }
    }, { passive: true });
  })();
</script>

</body>
</html>